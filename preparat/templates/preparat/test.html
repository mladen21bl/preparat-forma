<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<title>Prijava za registraciju dodatka prehrani test 2</title>
<style>
body { 
    font-family: Arial, Helvetica, sans-serif; 
    background-color: #f4f6f8; 
    color: #222; 
    margin:0; 
    padding:0; 
}

.container { 
    max-width: 950px; 
    margin: 40px auto; 
    background: #fff; 
    padding: 30px 40px; 
    border: 1px solid #ccc; 
    border-radius: 6px; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

h1 { 
    font-size: 28px; 
    text-align: center; 
    margin-bottom: 5px; 
}

.subtitle { 
    text-align: center; 
    font-size: 14px; 
    color: #555; 
    margin-bottom: 30px; 
}

fieldset { 
    border: 1px solid #bbb; 
    padding: 20px; 
    margin-bottom: 25px; 
    background-color: #eafcde; 
    border-radius: 6px; 
}

legend { 
    font-weight: bold; 
    padding: 0 10px; 
    color: #050505; 
    font-size: 20px; 
}

label { 
    font-weight: bold; 
}

p { 
    margin-bottom: 12px; 
}

input[type="text"], input[type="number"], select { 
    width: 220px; 
    padding: 6px 10px; 
    margin-top: 3px; 
    margin-bottom: 6px; 
    border: 1px solid #ccc; 
    border-radius: 4px; 
    font-size: 13px; 
}

input:focus, select:focus { 
    border-color: #003366; 
    outline: none; 
    box-shadow: 0 0 5px rgba(0,51,102,0.2);
}

input.invalid, select.invalid {
    border-color: red;
    background-color: #ffe6e6;
}

.help-text { 
    font-size: 12px; 
    color: #555; 
    margin-top: 3px;
}

.hidden { 
    display: none; 
}

button { 
    background-color: #003366; 
    color: #fff; 
    border: none; 
    padding: 10px 25px; 
    font-size: 14px; 
    cursor: pointer; 
    border-radius: 4px; 
}

button:hover { 
    background-color: #002244; 
}

hr { 
    border: none; 
    border-top: 1px dashed #ccc; 
    margin: 15px 0; 
}

.checkbox-group { 
    margin-left: 15px; 
    font-size: 13px; 
    font-weight: normal;
}

.flex-row { 
    display: flex; 
    align-items: center; 
    gap: 10px; 
    margin-bottom: 8px; 
    flex-wrap: wrap; 
}

.note { 
    font-size: 12px; 
    color: #555; 
    margin-top: 20px; 
    text-align: center; 
}

.add-btn { 
    background-color: #006600; 
    margin-top: 10px; 
}

.add-btn:hover { 
    background-color: #004400; 
}

.card {
    border: 1px solid #aaa; 
    padding: 15px; 
    margin-bottom: 15px; 
    border-radius: 6px; 
    background-color: #f0fff0; 
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}

.card hr { 
    border: none; 
    border-top: 1px dashed #ccc; 
    margin: 10px 0; 
}

.checkbox-group.invalid {
    border: 1px solid red;
    padding: 10px;
    border-radius: 4px;
    background-color: #ffe6e6;
}
</style>
</head>
<body>
<div class="container">
<h1>Prijava za registraciju dodatka prehrani test 2</h1>
<div class="subtitle">Simulacija postupka prijave – nastava iz farmakognozije</div>

<form id="prijavaForm" method="POST" action="{% url 'prijava_test2' %}" novalidate>
{% csrf_token %}

<!-- 1. Osnovni podaci -->
<fieldset>
<legend>1. Osnovni podaci o proizvodu</legend>
<p>Komercijalni naziv proizvoda:<br>
<input type="text" name="naziv" required {% if greske.naziv %}class="invalid"{% endif %}></p>

<p>Farmaceutski oblik:<br>
<select name="oblik" required {% if greske.oblik %}class="invalid"{% endif %}>
<option value="">Odaberite oblik</option>
<optgroup label="Čvrsti oblici">
<option value="tablete">Tablete</option>
<option value="kapsule">Kapsule</option>
<option value="prah">Prah</option>
<option value="granule">Granule</option>
<option value="pastile">Pastile</option>
</optgroup>
<optgroup label="Polučvrsti oblici">
<option value="mast">Mast</option>
<option value="gel">Gel</option>
<option value="krem">Krem</option>
</optgroup>
<optgroup label="Tečni oblici">
<option value="sirup">Sirup</option>
<option value="oralni_rastvor">Oralni rastvor</option>
<option value="kapi">Kapi</option>
<option value="tinktura">Tinktura</option>
<option value="sprej">Sprej</option>
<option value="ulje">Ulje</option>
<option value="čaj">Čaj</option>
</optgroup>
</select></p>

<p>Neto količina pakovanja:<br>
<div class="flex-row">
<input type="number" name="neto_kolicina" min="0" step="any" required {% if greske.neto_kolicina %}class="invalid"{% endif %}>
<select name="jedinica_kolicina" required {% if greske.jedinica_kolicina %}class="invalid"{% endif %}>
<option value="">Odaberi jedinicu</option>
<option value="g">g</option>
<option value="mg">mg</option>
<option value="ml">ml</option>
</select>
</div></p>
</fieldset>

<!-- 2. Ambalaža i čuvanje -->
<fieldset>
<legend>2. Ambalaža i uslovi čuvanja</legend>
<p>Tip ambalaže:<br>
<select name="tip_ambalaze" required {% if greske.tip_ambalaze %}class="invalid"{% endif %}>
<option value="">Odaberite tip</option>
<option value="bocica">Bočica</option>
<option value="blister">Blister</option>
<option value="vrećica">Vrećica</option>
<option value="pakiranje_caj">Pakovanje za čaj</option>
<option value="tubica">Tubica</option>
<option value="teglica">Teglica</option>
<option value="kartonska_kutija">Kartonska kutija</option>
<option value="bocica_kapaljka">Bočica sa kapaljkom</option>
</select></p>

<p>Materijal ambalaže:<br>
<select name="materijal_ambalaze" required {% if greske.materijal_ambalaze %}class="invalid"{% endif %}>
<option value="">Odaberite materijal</option>
<option value="plastika">Plastika</option>
<option value="staklo">Staklo</option>
<option value="aluminij">Aluminijum</option>
<option value="papir">Papir / Karton</option>
<option value="metal">Metal</option>
</select></p>

<p>Minimalna temperatura čuvanja (°C):<br>
<input type="number" name="temp_min" step="1" required {% if greske.temp_min %}class="invalid"{% endif %}></p>

<p>Maksimalna temperatura čuvanja (°C):<br>
<input type="number" name="temp_max" step="1" required {% if greske.temp_max %}class="invalid"{% endif %}></p>
</fieldset>

<!-- 3. Namena i način primjene -->
<fieldset>
<legend>3. Namjena i način primjene</legend>
<p>Zdravstvene izjave:<br>
<select name="namena" required {% if greske.namena %}class="invalid"{% endif %}>
<option value="">Odaberite namenu</option>
<option value="poboljsava_imunitet">Poboljšava imunitet</option>
<option value="poboljsava_probavu">Poboljšava probavu</option>
<option value="zdravlje_kose_koze">Zdravlje kose / kože / noktiju</option>
<option value="poboljsava_kosti">Poboljšava zdravlje kostiju</option>
<option value="smanjuje_umor">Smanjuje umor</option>
<option value="poboljsava_cirkulaciju">Poboljšava cirkulaciju</option>
<option value="podrzava_jetru">Podrška funkciji jetre</option>
<option value="poboljsava_snovi">Poboljšava san</option>
<option value="opste_zdravlje">Opšte zdravlje</option>
<option value="poboljsava_imunitet_probavu">Imunitet + probava</option>
<option value="podržava normalan nivo hemoglobina">Podržava normalan nivo hemoglobina</option>
</select></p>

<p>Preporučena dnevna doza:<br>
<div class="flex-row">
<input type="number" name="doza" min="0" step="any" required {% if greske.doza %}class="invalid"{% endif %}>
<select name="jedinica_doza" required {% if greske.jedinica_doza %}class="invalid"{% endif %}>
<option value="">Odaberi jedinicu</option>
<option value="kapsula">Kapsula</option>
<option value="tableta">Tableta</option>
<option value="ml">ml</option>
<option value="kasika">Kašika</option>
<option value="kasicica">Kašičica</option>
<option value="vrecica">Vrećica</option>
</select>
</div></p>

<p>Način primjene:<br>
<select name="nacin_uzimanja" required {% if greske.nacin_uzimanja %}class="invalid"{% endif %}>
<option value="">Odaberite način</option>
<option value="oralno">Oralno</option>
<option value="sublingvalno">Sublingvalno</option>
<option value="lokalno">Lokalno</option>
<option value="inhalacija">Inhalacija</option>
</select></p>
</fieldset>

<fieldset>
  <legend>4. Ograničenja i upozorenja</legend>

  <!-- Postoje ograničenja upotrebe -->
  <h3>Postoje ograničenja upotrebe</h3>
<div id="ogranicenjaBox" class="checkbox-group {% if greske.ogranicenja_djeca or greske.ogranicenja_trudnice or greske.ogranicenja_dojilje or greske.ogranicenja_hronicni %}invalid{% endif %}">
    <label><input type="checkbox" name="ogranicenja_djeca"> Djeca</label><br>
    <label><input type="checkbox" name="ogranicenja_trudnice"> Trudnice</label><br>
    <label><input type="checkbox" name="ogranicenja_dojilje"> Dojilje</label><br>
    <label><input type="checkbox" name="ogranicenja_hronicni"> Hronični pacijenti</label>
  </div>

  <!-- Mjere opreza -->
  <h3>Mjere opreza</h3>
  <div id="mjereBox" class="checkbox-group {% if greske.mjera_djeca or greske.mjera_doziranje or greske.mjera_zamjena or greske.mjera_obrok or greske.mjera_skladistenje %}invalid{% endif %}">
    <label><input type="checkbox" name="mjera_djeca"> Čuvati van domašaja djece</label><br>
    <label><input type="checkbox" name="mjera_doziranje"> Ne prekoračiti preporučenu dnevnu dozu</label><br>
    <label><input type="checkbox" name="mjera_zamjena"> Nije zamjena za raznovrsnu i uravnoteženu ishranu</label><br>
    <label><input type="checkbox" name="mjera_obrok"> Preporučuje se upotreba uz obrok</label><br>
    <label><input type="checkbox" name="mjera_skladistenje"> Čuvati na suhom i tamnom mjestu</label>
  </div>

  <!-- Upozorenja -->
  <h3>Upozorenja</h3>
  <div id="upozorenjaBox" class="checkbox-group {% if greske.upozorenje_alergije or greske.upozorenje_lijekovi or greske.upozorenje_gi or greske.upozorenje_pritisak or greske.upozorenje_secer %}invalid{% endif %}">
    <label><input type="checkbox" name="upozorenje_alergije"> Može izazvati alergijske reakcije</label><br>
    <label><input type="checkbox" name="upozorenje_lijekovi"> Moguća interakcija sa lijekovima</label><br>
    <label><input type="checkbox" name="upozorenje_gi"> Može izazvati gastrointestinalne smetnje</label><br>
    <label><input type="checkbox" name="upozorenje_pritisak"> Može uticati na krvni pritisak</label><br>
    <label><input type="checkbox" name="upozorenje_secer"> Može uticati na nivo šećera u krvi</label>
  </div>
</fieldset>

<!-- 5. Biljna droga -->
<fieldset id="biljna-container">
<legend>5. Biljna droga</legend>
<div class="biljna-droga card">
<p>Naziv biljke (SR): <input type="text" name="biljka_sr[]" {% if greske.biljne_droge %}class="invalid"{% endif %}></p>
<p>Latinski naziv: <input type="text" name="biljka_lat[]"></p>
<p>Dio biljke: <select name="dio_biljke[]">
<option value="korijen">Korijen</option>
<option value="rizom">Rizom</option>
<option value="list">List</option>
<option value="cvijet">Cvijet</option>
<option value="plod">Plod</option>
<option value="sjeme">Sjeme</option>
<option value="kora">Kora</option>
<option value="herba">Herba</option>
</select></p>
<p>Priprema biljne droge: <select name="stanje_biljke[]">
<option value="svjeza">Svježa</option>
<option value="osusena">Osušena</option>
<option value="fermentisana">Fermentisana</option>
<option value="preradjena">Prerađena / ekstrakt</option>
<option value="prah">Prah</option>
</select></p>
<p>Tip ekstrakta / rastvarača:<select name="rastvarac[]">
<option value="voda">Voda</option>
<option value="etanol_70">70% Etanol</option>
<option value="Metanol">Metanol</option>
<option value="aceton">Aceton</option>
<option value="Glicerol">Glicerol</option>
<option value="propilen_glikol">Propilen glikol</option>
</select></p>
<p>DER (Drug–Extract Ratio):<br><input type="text" name="der[]" placeholder="npr. 5:1"></p>
<p>Standardizacija ekstrakta:<div class="flex-row">
<input type="number" name="standardizacija_proc[]" min="0" step="any" style="width:80px;"> %
<select name="standardizacija_supstanca[]">
<option value="">Odaberi supstancu</option>
<option value="fe">Fe</option>
<option value="vitamin_c">Vitamin C</option>
<option value="huperzin_a">Huperzin A</option>
<option value="ginkgo_flavonoidi">Ginkgo flavonoidi</option>
<option value="saponini_ginseng">Saponini (Ginseng)</option>
<option value="alfa_lipoic_acid">Alfa-lipoinska kiselina</option>
</select>
</div></p>
<p>Zemlja porijekla:<select name="zemlja_porijekla[]">
<option value="">Odaberi zemlju</option>
<option value="srbija">Srbija</option>
<option value="bih">Bosna i Hercegovina</option>
<option value="eu">EU</option>
</select></p>
<p>Količina:<div class="flex-row">
<input type="number" name="kolicina_biljna[]" min="0" step="any">
<select name="jedinica_biljna[]">
<option value="mg">mg</option>
<option value="g">g</option>
<option value="ml">ml</option>
<option value="%">%</option>
</select>
</div></p>
</div>
<button type="button" class="add-btn" onclick="addBiljna()">Dodaj još biljnu drogu</button>
</fieldset>

<!-- 6. Aktivne supstance -->
<fieldset id="aktivna-container">
<legend>6. Aktivne supstance</legend>
<div class="aktivna-supstanca card">
<p>Naziv supstance: 
<input type="text" name="aktivna_naziv[]" 
{% if greske.aktivne_supstance %}class="invalid"{% endif %}>
</p>
<p>Hemijski oblik: <input type="text" name="hemijski_oblik[]"></p>
<p>Količina:<div class="flex-row">
<input type="number" name="kolicina_aktivna[]" min="0" step="any">
<select name="jedinica_aktivna[]">
<option value="mg">mg</option>
<option value="g">g</option>
<option value="ml">ml</option>
<option value="%">%</option>
</select>
</div></p>
</div>
<button type="button" class="add-btn" onclick="addAktivna()">Dodaj još supstanci</button>
</fieldset>

<!-- 7. Sertifikati -->
<fieldset>
<legend>7. Sertifikati BSE/TSE i GMO</legend>

<div class="card">
<div class="help-text">
BSE (Bovine Spongiform Encephalopathy) i TSE (Transmissible Spongiform Encephalopathy) sertifikati potvrđuju da biljni dodatak ne sadrži rizik od priona životinjskog porijekla.<br>
<br>GMO (Genetically Modified Organism) certifikat potvrđuje da proizvod ne sadrži genetski modificirane organizme.
</div>

<p>Stanje sertifikata:</p>
<div class="flex-row">
<input type="radio" name="bse_status" value="nije_potrebno" checked> Nije potrebno
<input type="radio" name="bse_status" value="prilozeno"> Priloženo
</div>

<p>Napomena / naziv dokumenta (BSE/TSE ili GMO):<br>
<input type="text" name="bse_napomena" placeholder="Unesite naziv dokumenta ili komentar"></p>
</div>
</fieldset>

<!-- 8. Klinička istraživanja -->
<fieldset>
<legend>8. Klinička istraživanja i naučni dokazi</legend>

<div class="card study-entry">
<p>Naziv studije: <input type="text" name="study_naziv[]"></p>
<p>Tip studije: 
<select name="study_tip[]">
<option value="klinicko">Kliničko</option>
<option value="laboratorijsko">Laboratorijsko / pre-kliničko</option>
<option value="literatura">Literatura / review</option>
</select>
</p>
<div class="help-text">
Kliničko: studije na ljudima.<br>
Laboratorijsko / pre-kliničko: studije in vitro ili na životinjama.<br>
Literatura / review: pregledni radovi i meta-analize.
</div>
<p>Godina / referenca: <input type="text" name="study_godina[]" placeholder="npr. 2021, Journal of Ethnopharmacology"></p>
<p>DOI broj:<br>
<input type="text" name="study_doi[]" placeholder="npr. 10.1016/j.jep.2021.114321">
<div class="help-text">
DOI (Digital Object Identifier) je jedinstveni identifikator naučne publikacije.
</div>
</p>
</div>
<button type="button" class="add-btn" onclick="addStudy()">Dodaj još studiju</button>

</fieldset>

<hr>
<button type="submit">Pošalji prijavu</button>
</form>
</div>

<script>
// Toggle sekcije
function toggleSection(id) {
    document.getElementById(id).classList.toggle("hidden");
}

// Dodavanje novih sekcija
function addBiljna() {
    let container = document.getElementById("biljna-container");
    let original = container.querySelector(".biljna-droga:last-of-type");
    let clone = original.cloneNode(true);
    clone.querySelectorAll("input").forEach(i => i.value = "");
    clone.querySelectorAll("select").forEach(s => s.selectedIndex = 0);
    container.insertBefore(clone, container.querySelector(".add-btn"));
}

function addAktivna() {
    let container = document.getElementById("aktivna-container");
    let original = container.querySelector(".aktivna-supstanca:last-of-type");
    let clone = original.cloneNode(true);
    clone.querySelectorAll("input").forEach(i => i.value = "");
    clone.querySelectorAll("select").forEach(s => s.selectedIndex = 0);
    container.insertBefore(clone, container.querySelector(".add-btn"));
}

function addStudy() {
    let container = document.querySelector('fieldset:nth-of-type(8)'); // 8. fieldset = Kliničke studije
    let original = container.querySelector(".study-entry:last-of-type");
    let clone = original.cloneNode(true);
    // očisti inpute
    clone.querySelectorAll("input").forEach(i => i.value = "");
    clone.querySelectorAll("select").forEach(s => s.selectedIndex = 0);
    // ubaci pre dugmeta
    let addBtn = container.querySelector(".add-btn");
    container.insertBefore(clone, addBtn);
}

// BSE radio toggle
document.querySelectorAll('input[name="bse_status"]').forEach(r => {
    r.addEventListener("change", function() {
        document.getElementById("bse_details")
        .classList.toggle("hidden", this.value === "nije_potrebno");
    });
});

// ==========================================
// KOMPLETNA VALIDACIJA ZA SVE SEGMENTE
// ==========================================
document.getElementById('prijavaForm').addEventListener('submit', function(e){
    e.preventDefault();
    let form = this;
    let valid = true;

    // ukloni stare invalid klase
    form.querySelectorAll('.invalid').forEach(el => el.classList.remove('invalid'));

    // 1–3 REQUIRED POLJA
    form.querySelectorAll('input[required], select[required]').forEach(el => {
        if(el.tagName.toLowerCase() === "select" && !el.value){
            el.classList.add('invalid'); valid = false;
        } else if((el.type === "text" || el.type === "number") && !el.value.trim()){
            el.classList.add('invalid'); valid = false;
        }
    });

    // 4. CHECKBOX GRUPE (mora bar 1 po grupi)
    ['ogranicenjaBox','mjereBox','upozorenjaBox'].forEach(id=>{
        let group = document.getElementById(id);
        let checked = group.querySelectorAll('input[type="checkbox"]:checked');
        if(checked.length === 0){
            group.classList.add('invalid');
            valid = false;
        }
    });

    // 5. BILJNA DROGA – validacija svakog input i select polja
    document.querySelectorAll('.biljna-droga').forEach(card=>{
        card.querySelectorAll('input, select').forEach(el=>{
            if(el.tagName.toLowerCase() === "select" && (!el.value || el.value === "")){
                el.classList.add('invalid'); valid = false;
            } else if((el.type === "text" || el.type === "number") && !el.value.trim()){
                el.classList.add('invalid'); valid = false;
            }
        });
    });

    // 6. AKTIVNE SUPSTANCE – validacija svih input i select polja
    document.querySelectorAll('.aktivna-supstanca').forEach(card=>{
        card.querySelectorAll('input, select').forEach(el=>{
            if(el.tagName.toLowerCase() === "select" && (!el.value || el.value === "")){
                el.classList.add('invalid'); valid = false;
            } else if((el.type === "text" || el.type === "number") && !el.value.trim()){
                el.classList.add('invalid'); valid = false;
            }
        });
    });
    // 7. BSE validacija
    let bseStatus = form.querySelector('input[name="bse_status"]:checked').value;
    if(bseStatus === "prilozeno"){
        let napomena = form.querySelector('input[name="bse_napomena"]');
        if(!napomena.value.trim()){
            napomena.classList.add('invalid'); valid = false;
        }
    }

    // 8. STUDIJE – validacija svakog polja ako je checkbox uključen
    let studiesToggle = document.getElementById("studiesToggle");
    if(studiesToggle.checked){
        document.querySelectorAll('.study-entry').forEach(card=>{
            card.querySelectorAll('input, select').forEach(el=>{
                if(el.tagName.toLowerCase() === "select" && !el.value){
                    el.classList.add('invalid'); valid = false;
                }
                if((el.type === "text" || el.type === "number") && !el.value.trim()){
                    el.classList.add('invalid'); valid = false;
                }
            });
        });
    }

    // scroll do prvog invalidnog elementa
    if(!valid){
        let firstInvalid = form.querySelector('.invalid');
        if(firstInvalid){
            firstInvalid.scrollIntoView({behavior:'smooth', block:'center'});
        }
        return false;
    }

    form.submit();
});
</script>
</body>
</html>